<!DOCTYPE html>
<html lang="en">

<head>
  <title>AWS Demo WebRTC Audio Recording using MediaStreamRecorder</title>

  <script src="https://cdn.WebRTC-Experiment.com/MediaStreamRecorder.js"></script>
  <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
  <script src="javascripts/main.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <style>
    .footer {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
      background-color: blue;
      color: white;
      text-align: center;
    }
  </style>
</head>

<body>
  <article>
    <header style="text-align: center;">
      <h1>
        <a href="https://www.webrtc-experiment.com/">WebRTC</a> Audio Recording using <a
          href="https://github.com/streamproc/MediaStreamRecorder" target="_blank">MediaStreamRecorder</a>
      </h1>
      <br>
    </header>

    <section>
      <div class="container">
        <div class="select">
          <label class="input-group-text" for="audioSource">Audio input source:</label>
        </div>
      </div>
      <br>
      <div class="select">
        <label for="audioSource">Audio input source: </label><select id="audioSource"></select>
      </div>

    </section>

    <section>
      <div class="container">
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text">Time Interval (milliseconds)</span>
          </div>
          <input type="text" id="time-interval" class="form-control" value="5000">
        </div>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <label class="input-group-text" for="audio-recorderType">Recorder Type</label>
          </div>
          <select class="custom-select" id="audio-recorderType">
            <option>[Best Available Recorder]</option>
            <option>MediaRecorder API</option>
            <option>WebAudio API (WAV)</option>
            <option>WebAudio API (PCM)</option>
          </select>
        </div>
        <input id="left-channel" type="checkbox" checked style="width:auto;">
        <label for="left-channel">Record Mono Audio if WebAudio API is selected (above)</label>
        <br>
        <br>
        <button type="button" class="btn btn-primary" id="start-recording">Start</button>
        <button type="button" class="btn btn-danger" id="stop-recording" disabled>Stop</button>
        <button type="button" class="btn btn-warning" id="pause-recording" disabled>Pause</button>
        <button type="button" class="btn btn-info" id="resume-recording" disabled>Resume</button>
        <button type="button" class="btn btn-success" id="save-recording" disabled>Save</button>
      </div>
    </section>
    <section>
      <br>
      <div class="container" id="audios-container"></div>
    </section>


    <script>
      //Functionality for Start Button
      document.querySelector('#start-recording').onclick = function () {
        this.disabled = true;
        console.log("#start-recording .onclick");
        captureUserMedia(mediaConstraints, onMediaSuccess, onMediaError);
      };

      document.querySelector('#stop-recording').onclick = function () {
        this.disabled = true;
        console.log("#stop-recording .onclick")
        mediaRecorder.stop();
        mediaRecorder.stream.stop();

        document.querySelector('#pause-recording').disabled = true;
        document.querySelector('#start-recording').disabled = false;
      };

      document.querySelector('#pause-recording').onclick = function () {
        this.disabled = true;
        console.log("#pause-recording .onclick")
        mediaRecorder.pause();

        document.querySelector('#resume-recording').disabled = false;
      };

      document.querySelector('#resume-recording').onclick = function () {
        this.disabled = true;
        console.log("#resume-recording .onclick")
        mediaRecorder.resume();

        document.querySelector('#pause-recording').disabled = false;
      };

      document.querySelector('#save-recording').onclick = function () {
        this.disabled = true;
        console.log("#save-recording .onclick")
        mediaRecorder.save();

        // alert('Drop WebM file on Chrome or Firefox. Both can play entire file. VLC player or other players may not work.');
      };

      var audiosContainer = document.getElementById('audios-container');
      var index = 1;

      // below function via: http://goo.gl/B3ae8c
      function bytesToSize(bytes) {
        var k = 1000;
        var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
        if (bytes === 0) return '0 Bytes';
        var i = parseInt(Math.floor(Math.log(bytes) / Math.log(k)), 10);
        return (bytes / Math.pow(k, i)).toPrecision(3) + ' ' + sizes[i];
      }

      // below function via: http://goo.gl/6QNDcI
      function getTimeLength(milliseconds) {
        var data = new Date(milliseconds);
        return data.getUTCHours() + " hours, " + data.getUTCMinutes() + " minutes and " + data.getUTCSeconds() + " second(s)";
      }
    </script>

    <div class="footer">
      <p>
        USCIS Innovation Lab (ILAB)
      </p>
    </div>
</body>

</html>